<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="/build/wasm/AudioWorklet.js"></script>
</head>

<body id="body">
    <span id="volume_name"></span>
    <input style="width: 300px;" type="range" class="slider" id="volume">
    <span id="volume_value">30%</span><br>

    <span id="volume2_name"></span>
    <input style="width: 300px;" type="range" class="slider" id="volume2">
    <span id="volume2_value">30%</span><br>

    <script>
        // CLAP
        function sendParamValueUpdate(_id, _value) {
            window.webkit.messageHandlers.jsHandler.postMessage({
                action: "sendParamValueUpdate",
                id: _id,
                value: _value
            });
        }

        // CLAP
        function receiveParamValueUpdate(id, value) {
            const volumeSlider = document.querySelector(id);
            document.querySelector(id + "_value").innerHTML = value;
            volumeSlider.value = value;
        }

        // WASM + CLAP
        function linkParameter(info, wasmNodeHandle) {
            console.log(info);
            console.log(info.id);
            console.log(info.minValue);
            const htmlParam = document.querySelector(info.id);
            htmlParam.min = info.minValue;
            htmlParam.max = info.maxValue;
            htmlParam.value = info.defaultValue;
            htmlParam.step = info.step;

            document.querySelector(info.id + "_name").innerHTML = htmlParam.name;

            // This will call into the C++ to update the value.
            htmlParam.oninput = (e) => {
                document.querySelector(info.id + "_value").innerHTML = e.target.value + info.unit;
                let value = parseFloat(e.target.value);
                if (wasmNodeHandle) {
                    wasmNodeHandle.parameters.get(0).value = parseFloat(e.target.value);
                } else {
                    sendParamValueUpdate(info.handle, value);
                }
            };
        }

        // CLAP
        function setup() {
            // Send a request to get the plugin parameter info
            window.webkit.messageHandlers.jsHandler.postMessage({
                action: "sendPluginInfo"
            });

            // Send a request to fully update parameters.
            window.webkit.messageHandlers.jsHandler.postMessage({
                action: "initializeValues",
            });
        }

        document.addEventListener("DOMContentLoaded", function (event) {
            if (window.webkit) {
                setup();
            }
        });

    </script>
</body>

</html>
